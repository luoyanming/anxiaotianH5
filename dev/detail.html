<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="yes" name="apple-touch-fullscreen">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no,email=no" name="format-detection">
        <meta name="description" content="安小天描述">
        <meta name="keywords" content="安小天关键字">
        <title>安小天</title>
        <link rel="stylesheet" href="./static/style/style.css">
        <script src="./static/script/lib/jquery.2.0.0.min.js"></script>
        <script src="./static/script/common.js"></script>
        <script>
            window.requireLogin = true;
        </script>
        <script src="./static/script/check.js"></script>
    </head>

    <body class="flex-v">

        <header class="header">
            <div class="wrapper">
                <a href="./index.html" class="logo">安小天</a>
                <a href="javascript:void(0);" class="btn-nav">
                    <span class="line line-1"></span>
                    <span class="line line-2"></span>
                </a>
            </div>

            <div class="menu">
                <nav class="nav">
                    <ul>
                        <li><a href="./EH330.html">悬挂式</a></li>
                        <li><a href="./M6P.html">通用型</a></li>
                        <li><a href="./V92.html">流媒体</a></li>
                        <li><a href="./YJ801.html">便捷式</a></li>
                        <li><a href="./help.html">帮助中心</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        
        <div class="main flex-a-i flex-v">
            <section class="order-detail flex-a-i">
                <div class="title">订单信息</div>
                
                <div class="info-box">
                <!-- 
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>详细地址</span>
                        </div>
                        <div class="flex-a-i">
                            <p>李彦, 13777486677, 浙江省 杭州市 余杭区 仓前街道 文一西路998号海创园4号楼705</p>
                        </div>
                    </div>
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>订单编号</span>
                        </div>
                        <div class="flex-a-i">
                            <p>26483529021535965</p>
                        </div>
                    </div>
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>付款时间</span>
                        </div>
                        <div class="flex-a-i">
                            <p>2017-06-07 12:44:22</p>
                        </div>
                    </div>
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>付款方式</span>
                        </div>
                        <div class="flex-a-i">
                            <p>支付宝平台支付</p>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="info flex-h">
                            <div class="thumb flex-v-c">
                                <img src="./static/images/product_EH330_01.png">
                            </div>
                            <div class="flex-a-i">
                                <p class="name">悬挂式智能后视镜</p>
                                <p class="per-price">￥1999.00</p>
                            </div>
                            <div class="num flex-v-c">
                                <span>x 1</span>
                            </div>
                        </div>
                        <div class="btn-box flex-h">
                            <p class="state state-pay">已付款</p>
                            <p class="flex-a-i">
                                <span class="trans-price">运费：0</a>
                                <span class="order-price">订单总价：￥1999.00</span>
                            </p>
                        </div>
                    </div>
                    <div class="pay-price">实付款：<span>￥1999.00</span></div>
                 -->

                <!-- 
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>详细地址</span>
                        </div>
                        <div class="flex-a-i">
                            <p>李彦, 13777486677, 浙江省 杭州市 余杭区 仓前街道 文一西路998号海创园4号楼705</p>
                        </div>
                    </div>
                    <div class="item-block flex-h">
                        <div class="flex-v-c">
                            <span>订单编号</span>
                        </div>
                        <div class="flex-a-i">
                            <p>26483529021535965</p>
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="info flex-h">
                            <div class="thumb flex-v-c">
                                <img src="./static/images/product_EH330_01.png">
                            </div>
                            <div class="flex-a-i">
                                <p class="name">悬挂式智能后视镜</p>
                                <p class="per-price">￥1999.00</p>
                            </div>
                            <div class="num flex-v-c">
                                <span>x 1</span>
                            </div>
                        </div>
                        <div class="btn-box flex-h">
                            <p class="state state-unpay">未支付</p>
                            <p class="flex-a-i">
                                <span class="trans-price">运费：0</a>
                                <span class="order-price">订单总价：￥1999.00</span>
                            </p>
                        </div>
                    </div>

                    <a href="./index.html" class="btn-pay">去支付</a>
                 -->
                 </div>
            </section>
            

            <footer class="footer">
                <div class="container clearfix">
                    <!-- <div class="wechat-account">
                        <div class="img-wrapper"><img src="xxxxxxxxxxxx.jpg"></div>
                        <p class="text">微信公众号</p>
                    </div> -->

                    <div class="info">
                        <p class="title">服务热线 <a href="tel:4008292178" class="telephone">400-8292-178</a></p>
                        <p class="copyright">&copy;2014 江苏天安智联科技股份有限公司</p>
                        <p class="copyright"><a href="http://www.miitbeian.gov.cn" style="color: #8f8e94;">苏ICP备15000165号</a></p>
                    </div>
                </div>
            </footer>
        </div>

        <script src="./static/script/axt.js"></script>

        <script>
            $(function() {
                var DETAIL = {
                    init: function() {
                        DETAIL.getDetail();
                    },
                    getDetail: function() {
                        $.ajax({
                            url: BASEURL + '/getOrder',
                            dataType: "json",
                            type: "post",
                            data: {
                                id: COMMON.getQueryString('id')
                            },
                            success:function(data) {
                                if(data.code == 10003) {
                                    return false;
                                } else if(data.code == 0) {
                                    var orderDetail = data.data.order,
                                        str = '';

                                    str += '<div class="item-block flex-h">';
                                    str += '<div class="flex-v-c">';
                                    str += '<span>详细地址</span>';
                                    str += '</div>';
                                    str += '<div class="flex-a-i">';
                                    str += '<p>'+ orderDetail.receiverName +', '+ orderDetail.receiverMobile +', '+ orderDetail.address +'</p>';
                                    str += '</div>';
                                    str += '</div>';
                                    str += '<div class="item-block flex-h">';
                                    str += '<div class="flex-v-c">';
                                    str += '<span>订单编号</span>';
                                    str += '</div>';
                                    str += '<div class="flex-a-i">';
                                    str += '<p>'+ orderDetail.orderTradeid +'</p>';
                                    str += '</div>';
                                    str += '</div>';
                                    str += '<div class="item-block flex-h">';
                                    str += '<div class="flex-v-c">';
                                    str += '<span>付款时间</span>';
                                    str += '</div>';
                                    str += '<div class="flex-a-i">';

                                    var newtime = new Date(orderDetail.lastUpdatedDate),
                                        newtimeStr = '';

                                    newtimeStr += newtime.getFullYear() + '/' + (newtime.getMonth() + 1) + '/' + newtime.getDate() + ' ' + newtime.getHours() + ':';

                                    if(newtime.getMinutes() < 10) {
                                        newtimeStr += '0' + newtime.getMinutes() + ':';
                                    } else {
                                        newtimeStr += newtime.getMinutes() + ':';
                                    }

                                    if(newtime.getSeconds() < 10) {
                                        newtimeStr += '0' + newtime.getSeconds() + ':';
                                    } else {
                                        newtimeStr += newtime.getSeconds() + ':';
                                    }

                                    str += '<p>'+ newtimeStr +'</p>';

                                    str += '</div>';
                                    str += '</div>';
                                    str += '<div class="item-block flex-h">';
                                    str += '<div class="flex-v-c">';
                                    str += '<span>付款方式</span>';
                                    str += '</div>';
                                    str += '<div class="flex-a-i">';
                                    str += '<p>'+ orderDetail.payType +'</p>';
                                    str += '</div>';
                                    str += '</div>';
                                    str += '<div class="product-info">';
                                    str += '<div class="info flex-h">';
                                    for(var j = 0; j < COMMON.prodList.length; j++) {
                                        if(orderDetail.commodityId == COMMON.prodList[j].id) {
                                            var name = COMMON.prodList[j].name,
                                                price = COMMON.prodList[j].price,
                                                thumb = COMMON.prodList[j].thumb;

                                            str += '<div class="thumb flex-v-c">';
                                            str += '<img src="'+ thumb +'">';
                                            str += '</div>';
                                            str += '<div class="flex-a-i">';
                                            str += '<p class="name">'+ name +'</p>';
                                            str += '<p class="per-price">￥'+ price +'</p>';
                                            str += '</div>';
                                        }
                                    }
                                    str += '<div class="num flex-v-c">';
                                    str += '<span>x '+ orderDetail.number +'</span>';
                                    str += '</div>';
                                    str += '</div>';
                                    str += '<div class="btn-box flex-h">';
                                    if(orderDetail.status == 1){
                                        str += '<p class="state state-pay">已付款</p>';
                                    } else if(orderDetail.status == 0) {
                                        str += '<p class="state state-unpay">待支付</p>';
                                    } else if(orderDetail.status == 2) {
                                        str += '<p class="state state-unpay">支付失败</p>';
                                    }
                                    str += '<p class="flex-a-i">';
                                    str += '<span class="trans-price">运费：0</a>';
                                    str += '<span class="order-price">订单总价：<i>￥'+ orderDetail.totalPrice +'</i></span>';
                                    str += '</p>';
                                    str += '</div>';
                                    str += '</div>';
                                    if(orderDetail.status == 1) {
                                        str += '<div class="pay-price">实付款：<span>￥'+ orderDetail.totalPrice +'</span></div>';
                                    } else {
                                        str += '<a href="javascript:void(0);" class="btn-pay">去支付</a>';
                                        str += '<form action="'+ BASEURL +'/modifyOrder" method="post" id="form" onsubmit="return false">';
                                        str += '<input hidden name="id" value="'+ orderDetail.id +'" />';
                                        str += '<input hidden name="commodityId" value="'+ orderDetail.commodityId +'" />';
                                        str += '<input hidden name="number" value="'+ orderDetail.number +'" />';
                                        str += '<input hidden name="memberAddressId" value="'+ orderDetail.memberAddressId +'" />';
                                        if(orderDetail.payType == '支付宝') {
                                            str += '<input hidden name="payType" value="3" />';
                                        } else if(orderDetail.payType == '微信') {
                                            str += '<input hidden name="payType" value="4" />';
                                        }
                                        str += '</form>';
                                    }


                                    $('.order-detail .info-box').html(str);

                                    DETAIL.btnPayBind();
                                } else {
                                    alert.html(data.msg);
                                }
                            },
                            error: function() {
                                alert('获取订单详情失败！请重试！');
                            }
                        });
                    },
                    btnPayBind: function() {
                        $('.btn-pay').on('click', function() {
                            document.getElementById('form').submit();
                        });
                    }
                };

                DETAIL.init();
            });
        </script>
    </body>
</html>

